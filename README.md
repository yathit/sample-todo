YDN-DB todo application
=======================

YDN-DB javascript database library is abstraction layer for multiple storage mechanisms, including [IndexedDB](http://www.w3.org/TR/IndexedDB/), [Web SQL database](http://en.wikipedia.org/wiki/Web_SQL_Database) and [WebStorage](http://www.w3.org/TR/webstorage/) (localStorage). On top of that, ydn-db provides ORM like query capability.

Database schema
---------------

The first thing you need to think using database is its schema. A database in IndexedDB, and hence YDN-DB, are composed of several Object Stores. You will create an object store for each type of data. Each Object Store can have a collection of Indexes that make it efficient to query and iterate across. Being key-document store, there is no relationship between object stores.

This sample application code demonstrate very simple use case of ynd-db library to build todo list manager similar to [HTML5Rocks todo list example](http://www.html5rocks.com/en/tutorials/indexeddb/todo/). In this simple app, there is only one data type to store, the todo data. Each database record has a key and a value. The value is a simple javascript object. For todo list app, we will use number generated by current timestamp. The key of an object can be defined within the value or externally, known as in-line key and out-of-line key respectively. If in-line key is used, object store schema has [keyPath](http://www.w3.org/TR/IndexedDB/#key-path-construct) pointing to its key, or primary key. Here is todo database schema:

    var schema = {
      version: 1,
      stores:[{
        name:'todo',
        keyPath:"timeStamp"
      }]
    };

  This is an example todo data:

    {
      text: "Write an sample app",
      timeStamp: 1383211366420
    }

Database connection
-------------------

Database connection is created simply in instantiated `ydn.db.Storage` class, exported from the library providing database name and schema.

    var db = new ydn.db.Storage('todo-app', schema);

Notice that schema defines optional `version`. If version is provided, the version is used when opening IndexedDB. If not provided, the library will open existing database or create a new one. If existing database schema is different, the connection will be closed and open with larger version to upgrade the schema. It is recommended to provide database version for real life application. Database version must increase whenever there is a schema change.

The database instance, `db`, can be used immediately, but all request placed will be in queued. Request can be place only after database connection. For heavy database request should place only after database connection is established as follow:

    db.onReady(function(e) {
      if (e) {
        // db opening fail.
        throw e;
      }
      init(); // start using database
    });

Storing data
------------

Data is stored using `put` method.

    var data = {
      "text": todo.value,
      "timeStamp": new Date().getTime()
    };
    db.put('todo', data);

Reading data
------------

If we know the key, a record is read by using `get` method. If we do not know the key, record can be iterated on whole or part of object store. Iterating whole database is done as follow:

    var df = db.values('todo');

    df.done(function (items) {
      var n = items.length;
      for (var i = 0; i < n; i++) {
        renderTodo(items[i]);
      }
    });

By default, records are ordered by ascending order of primary key.

Deleting record
---------------

A record is deleted by using `remove` method. If primary key(s) is not know, `clear` method is used to clear whole or portion of an Object Store.

    db.remove('todo', key);

Conclusion
----------

This simple application show only very simple use case of ydn-db library. We discussed best practice for database creation. Check out [running demo app](http://yathit.github.io/sample-todo/).
